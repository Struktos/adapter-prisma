<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@struktos/prisma</title><meta name="description" content="Documentation for @struktos/prisma"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@struktos/prisma</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@struktos/prisma</h2></div><div class="tsd-panel tsd-typography"><a id="md:struktosprisma" class="tsd-anchor"></a><h1><a href="#md:struktosprisma">@struktos/prisma</a></h1><p>Prisma adapter for Struktos.js - Unit of Work and repository implementations using Prisma Client.</p>
<p><a href="https://www.npmjs.com/package/@struktos/prisma"><img src="https://badge.fury.io/js/%40struktos%2Fprisma.svg" alt="npm version"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a>
<a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-5.3-blue.svg" alt="TypeScript"></a></p>
<a id="md:features" class="tsd-anchor"></a><h2><a href="#md:features">Features</a></h2><ul>
<li>üîÑ <strong>Unit of Work Pattern</strong> - Transaction management with automatic commit/rollback</li>
<li>üíæ <strong>Interactive Transactions</strong> - Uses Prisma&#39;s interactive transaction API</li>
<li>üì¶ <strong>Repository Pattern</strong> - Base classes for implementing Prisma repositories</li>
<li>üéØ <strong>Savepoint Support</strong> - Partial rollback capability (PostgreSQL, MySQL)</li>
<li>üîç <strong>Context Integration</strong> - Request context propagation for distributed tracing</li>
<li>üìä <strong>All Isolation Levels</strong> - Full support for transaction isolation levels</li>
<li>üìò <strong>TypeScript First</strong> - Complete type safety and IntelliSense</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2><a href="#md:installation">Installation</a></h2><pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@struktos/prisma</span><span class="hl-1"> </span><span class="hl-2">@struktos/core</span><span class="hl-1"> </span><span class="hl-2">@prisma/client</span><br/><span class="hl-7"># or</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@struktos/prisma</span><span class="hl-1"> </span><span class="hl-2">@struktos/core</span><span class="hl-1"> </span><span class="hl-2">@prisma/client</span><br/><span class="hl-7"># or</span><br/><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@struktos/prisma</span><span class="hl-1"> </span><span class="hl-2">@struktos/core</span><span class="hl-1"> </span><span class="hl-2">@prisma/client</span>
</code><button>Copy</button></pre>
<a id="md:quick-start" class="tsd-anchor"></a><h2><a href="#md:quick-start">Quick Start</a></h2><a id="md:1-create-repository-classes" class="tsd-anchor"></a><h3><a href="#md:1-create-repository-classes">1. Create Repository Classes</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PrismaCrudRepository</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/prisma&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> { </span><span class="hl-4">User</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@prisma/client&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Interface for your repository</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-9">IUserRepository</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">findById</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">findByEmail</span><span class="hl-1">(</span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">findAll</span><span class="hl-1">(): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1">[]&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">create</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-9">Omit</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1">, </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;createdAt&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;updatedAt&#39;</span><span class="hl-1">&gt;): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-9">Partial</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1">&gt;): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">delete</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">boolean</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Prisma implementation</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-9">PrismaUserRepository</span><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-9">PrismaCrudRepository</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1">, </span><span class="hl-9">string</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-5">implements</span><span class="hl-1"> </span><span class="hl-9">IUserRepository</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">protected</span><span class="hl-1"> </span><span class="hl-0">getModelDelegate</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">findByEmail</span><span class="hl-1">(</span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">User</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">findUnique</span><span class="hl-1">({ </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">email</span><span class="hl-1"> } });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:2-set-up-unit-of-work-factory" class="tsd-anchor"></a><h3><a href="#md:2-set-up-unit-of-work-factory">2. Set Up Unit of Work Factory</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PrismaClient</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@prisma/client&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PrismaUnitOfWorkFactory</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/prisma&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">IsolationLevel</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">prisma</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">PrismaClient</span><span class="hl-1">();</span><br/><br/><span class="hl-7">// Create factory with configuration</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">uowFactory</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">PrismaUnitOfWorkFactory</span><span class="hl-1">(</span><span class="hl-4">prisma</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">defaultTimeout:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">defaultIsolationLevel:</span><span class="hl-1"> </span><span class="hl-4">IsolationLevel</span><span class="hl-1">.</span><span class="hl-4">ReadCommitted</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">enableSavepoints:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">, </span><span class="hl-7">// Optional logging</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Register repository factories</span><br/><span class="hl-4">uowFactory</span><span class="hl-1">.</span><span class="hl-0">registerRepository</span><span class="hl-1">(</span><span class="hl-2">&#39;UserRepository&#39;</span><span class="hl-1">, (</span><span class="hl-4">tx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">PrismaUserRepository</span><span class="hl-1">(</span><span class="hl-4">tx</span><span class="hl-1">));</span><br/><span class="hl-4">uowFactory</span><span class="hl-1">.</span><span class="hl-0">registerRepository</span><span class="hl-1">(</span><span class="hl-2">&#39;OrderRepository&#39;</span><span class="hl-1">, (</span><span class="hl-4">tx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">PrismaOrderRepository</span><span class="hl-1">(</span><span class="hl-4">tx</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>
<a id="md:3-use-in-your-application" class="tsd-anchor"></a><h3><a href="#md:3-use-in-your-application">3. Use in Your Application</a></h3><pre><code class="language-typescript"><span class="hl-7">// Create Unit of Work instance</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">uow</span><span class="hl-1"> = </span><span class="hl-4">uowFactory</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">();</span><br/><br/><span class="hl-7">// Execute within transaction</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">executeInTransaction</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">unitOfWork</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">userRepo</span><span class="hl-1"> = </span><span class="hl-4">unitOfWork</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IUserRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;UserRepository&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">orderRepo</span><span class="hl-1"> = </span><span class="hl-4">unitOfWork</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IOrderRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;OrderRepository&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// All operations are in the same transaction</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">newUser</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">userRepo</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;John Doe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&#39;john@example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">orderRepo</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">newUser</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">total:</span><span class="hl-1"> </span><span class="hl-8">99.99</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">newUser</span><span class="hl-1">;</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:advanced-usage" class="tsd-anchor"></a><h2><a href="#md:advanced-usage">Advanced Usage</a></h2><a id="md:manual-transaction-control" class="tsd-anchor"></a><h3><a href="#md:manual-transaction-control">Manual Transaction Control</a></h3><pre><code class="language-typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">uow</span><span class="hl-1"> = </span><span class="hl-4">uowFactory</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">();</span><br/><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">isolationLevel:</span><span class="hl-1"> </span><span class="hl-4">IsolationLevel</span><span class="hl-1">.</span><span class="hl-4">Serializable</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-8">60000</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">accountRepo</span><span class="hl-1"> = </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IAccountRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;AccountRepository&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Debit source account</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">source</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">accountRepo</span><span class="hl-1">.</span><span class="hl-0">findById</span><span class="hl-1">(</span><span class="hl-4">fromAccountId</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">source</span><span class="hl-1">.</span><span class="hl-4">balance</span><span class="hl-1"> &lt; </span><span class="hl-4">amount</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">InsufficientFundsError</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">accountRepo</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">fromAccountId</span><span class="hl-1">, { </span><span class="hl-4">balance:</span><span class="hl-1"> </span><span class="hl-4">source</span><span class="hl-1">.</span><span class="hl-4">balance</span><span class="hl-1"> - </span><span class="hl-4">amount</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Credit destination account</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">dest</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">accountRepo</span><span class="hl-1">.</span><span class="hl-0">findById</span><span class="hl-1">(</span><span class="hl-4">toAccountId</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">accountRepo</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">toAccountId</span><span class="hl-1">, { </span><span class="hl-4">balance:</span><span class="hl-1"> </span><span class="hl-4">dest</span><span class="hl-1">.</span><span class="hl-4">balance</span><span class="hl-1"> + </span><span class="hl-4">amount</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">commit</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Transfer completed in </span><span class="hl-5">${</span><span class="hl-4">result</span><span class="hl-10">.</span><span class="hl-4">duration</span><span class="hl-5">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">rollback</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-3">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:using-savepoints" class="tsd-anchor"></a><h3><a href="#md:using-savepoints">Using Savepoints</a></h3><pre><code class="language-typescript"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><br/><span class="hl-7">// Create initial user</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">userRepo</span><span class="hl-1"> = </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IUserRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;UserRepository&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">userRepo</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({ </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Alice&#39;</span><span class="hl-1">, </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&#39;alice@example.com&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-7">// Create savepoint before risky operation</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">createSavepoint</span><span class="hl-1">(</span><span class="hl-2">&#39;before_order&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">orderRepo</span><span class="hl-1"> = </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IOrderRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;OrderRepository&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">orderRepo</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">total:</span><span class="hl-1"> -</span><span class="hl-8">100</span><span class="hl-1"> }); </span><span class="hl-7">// Invalid!</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// Rollback only the order, keep the user</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">rollbackToSavepoint</span><span class="hl-1">(</span><span class="hl-2">&#39;before_order&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Commit - user is saved, order is not</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">commit</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:context-integration" class="tsd-anchor"></a><h3><a href="#md:context-integration">Context Integration</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">RequestContext</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/core&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// In your middleware</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">((</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><br/><span class="hl-1">    { </span><br/><span class="hl-1">      </span><span class="hl-4">traceId:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">[</span><span class="hl-2">&#39;x-trace-id&#39;</span><span class="hl-1">] || </span><span class="hl-0">generateTraceId</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">?.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">ctx</span><span class="hl-1"> = </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">current</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">uow</span><span class="hl-1"> = </span><span class="hl-4">uowFactory</span><span class="hl-1">.</span><span class="hl-0">createWithContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">unitOfWork</span><span class="hl-1"> = </span><span class="hl-4">uow</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// In your handler</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">post</span><span class="hl-1">(</span><span class="hl-2">&#39;/orders&#39;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">unitOfWork</span><span class="hl-1">.</span><span class="hl-0">executeInTransaction</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">uow</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Operations automatically include trace ID in logs</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">orderRepo</span><span class="hl-1"> = </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">getRepository</span><span class="hl-1">&lt;</span><span class="hl-9">IOrderRepository</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;OrderRepository&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">orderRepo</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:custom-repository-implementation" class="tsd-anchor"></a><h3><a href="#md:custom-repository-implementation">Custom Repository Implementation</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">PrismaRepository</span><span class="hl-1">, </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">PrismaTransactionClient</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/prisma&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-9">Product</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">price</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">stock</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-9">PrismaProductRepository</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-9">PrismaRepository</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">, </span><span class="hl-9">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-5">protected</span><span class="hl-1"> </span><span class="hl-0">getModelDelegate</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-4">product</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">findById</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">findUnique</span><span class="hl-1">({ </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1"> } });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">findAll</span><span class="hl-1">(): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">findMany</span><span class="hl-1">({ </span><span class="hl-4">orderBy:</span><span class="hl-1"> { </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;asc&#39;</span><span class="hl-1"> } });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">create</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-9">Omit</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">, </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1">&gt;): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({ </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-9">Partial</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">&gt;): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({ </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1"> }, </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">    } </span><span class="hl-3">catch</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">null</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">delete</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">boolean</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">delete</span><span class="hl-1">({ </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1"> } });</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">;</span><br/><span class="hl-1">    } </span><span class="hl-3">catch</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">false</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Custom methods</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">findInStock</span><span class="hl-1">(): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">findMany</span><span class="hl-1">({ </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">stock:</span><span class="hl-1"> { </span><span class="hl-4">gt:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> } } });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">decrementStock</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">Product</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">where:</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">stock:</span><span class="hl-1"> { </span><span class="hl-4">gte:</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1"> } },</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">stock:</span><span class="hl-1"> { </span><span class="hl-4">decrement:</span><span class="hl-1"> </span><span class="hl-4">quantity</span><span class="hl-1"> } },</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:error-handling" class="tsd-anchor"></a><h3><a href="#md:error-handling">Error Handling</a></h3><pre><code class="language-typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">TransactionError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">TransactionTimeoutError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">RepositoryNotRegisteredError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">NoActiveTransactionError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">ErrorCodes</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@struktos/prisma&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">uow</span><span class="hl-1">.</span><span class="hl-0">executeInTransaction</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">unitOfWork</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// ... operations</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-5">instanceof</span><span class="hl-1"> </span><span class="hl-9">TransactionTimeoutError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Transaction timed out after </span><span class="hl-5">${</span><span class="hl-4">error</span><span class="hl-10">.</span><span class="hl-4">timeoutMs</span><span class="hl-5">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-5">instanceof</span><span class="hl-1"> </span><span class="hl-9">RepositoryNotRegisteredError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Repository &#39;</span><span class="hl-5">${</span><span class="hl-4">error</span><span class="hl-10">.</span><span class="hl-4">repositoryToken</span><span class="hl-5">}</span><span class="hl-2">&#39; not registered`</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-5">instanceof</span><span class="hl-1"> </span><span class="hl-9">TransactionError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Transaction error [</span><span class="hl-5">${</span><span class="hl-4">error</span><span class="hl-10">.</span><span class="hl-4">code</span><span class="hl-5">}</span><span class="hl-2">]:`</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Or check by error code</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">code</span><span class="hl-1"> === </span><span class="hl-4">ErrorCodes</span><span class="hl-1">.</span><span class="hl-6">TRANSACTION_TIMEOUT</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// Handle timeout</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:api-reference" class="tsd-anchor"></a><h2><a href="#md:api-reference">API Reference</a></h2><a id="md:prismaunitofwork" class="tsd-anchor"></a><h3><a href="#md:prismaunitofwork">PrismaUnitOfWork</a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>start(options?)</code></td>
<td>Start a new transaction</td>
</tr>
<tr>
<td><code>commit()</code></td>
<td>Commit the transaction</td>
</tr>
<tr>
<td><code>rollback()</code></td>
<td>Rollback the transaction</td>
</tr>
<tr>
<td><code>getRepository&lt;T&gt;(token)</code></td>
<td>Get a repository instance</td>
</tr>
<tr>
<td><code>hasRepository(token)</code></td>
<td>Check if repository is registered</td>
</tr>
<tr>
<td><code>executeInTransaction(callback, options?)</code></td>
<td>Execute within auto-managed transaction</td>
</tr>
<tr>
<td><code>createSavepoint(name)</code></td>
<td>Create a savepoint</td>
</tr>
<tr>
<td><code>rollbackToSavepoint(name)</code></td>
<td>Rollback to a savepoint</td>
</tr>
<tr>
<td><code>releaseSavepoint(name)</code></td>
<td>Release a savepoint</td>
</tr>
<tr>
<td><code>setContext(context)</code></td>
<td>Set request context</td>
</tr>
<tr>
<td><code>dispose()</code></td>
<td>Dispose and release resources</td>
</tr>
</tbody></table>
<a id="md:prismaunitofworkfactory" class="tsd-anchor"></a><h3><a href="#md:prismaunitofworkfactory">PrismaUnitOfWorkFactory</a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>create()</code></td>
<td>Create a new Unit of Work instance</td>
</tr>
<tr>
<td><code>createWithContext(context)</code></td>
<td>Create with associated context</td>
</tr>
<tr>
<td><code>registerRepository(token, factory)</code></td>
<td>Register a repository factory</td>
</tr>
<tr>
<td><code>hasRepository(token)</code></td>
<td>Check if repository is registered</td>
</tr>
<tr>
<td><code>unregisterRepository(token)</code></td>
<td>Remove a repository factory</td>
</tr>
<tr>
<td><code>getRegisteredRepositories()</code></td>
<td>List all registered repositories</td>
</tr>
</tbody></table>
<a id="md:configuration-options" class="tsd-anchor"></a><h3><a href="#md:configuration-options">Configuration Options</a></h3><pre><code class="language-typescript"><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-9">PrismaUnitOfWorkConfig</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">defaultTimeout</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">;        </span><span class="hl-7">// Default: 30000ms</span><br/><span class="hl-1">  </span><span class="hl-4">defaultMaxWait</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">;        </span><span class="hl-7">// Default: 5000ms</span><br/><span class="hl-1">  </span><span class="hl-4">defaultIsolationLevel</span><span class="hl-1">?: </span><span class="hl-9">IsolationLevel</span><span class="hl-1">;  </span><span class="hl-7">// Default: ReadCommitted</span><br/><span class="hl-1">  </span><span class="hl-4">enableSavepoints</span><span class="hl-1">?: </span><span class="hl-9">boolean</span><span class="hl-1">;     </span><span class="hl-7">// Default: true</span><br/><span class="hl-1">  </span><span class="hl-4">logger</span><span class="hl-1">?: </span><span class="hl-9">PrismaUnitOfWorkLogger</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:isolation-levels" class="tsd-anchor"></a><h2><a href="#md:isolation-levels">Isolation Levels</a></h2><table>
<thead>
<tr>
<th>Level</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ReadUncommitted</code></td>
<td>Allows dirty reads</td>
</tr>
<tr>
<td><code>ReadCommitted</code></td>
<td>Default for most databases</td>
</tr>
<tr>
<td><code>RepeatableRead</code></td>
<td>Prevents non-repeatable reads</td>
</tr>
<tr>
<td><code>Serializable</code></td>
<td>Highest isolation</td>
</tr>
<tr>
<td><code>Snapshot</code></td>
<td>Uses row versioning (PostgreSQL, SQL Server)</td>
</tr>
</tbody></table>
<a id="md:related-packages" class="tsd-anchor"></a><h2><a href="#md:related-packages">Related Packages</a></h2><ul>
<li><code>@struktos/core</code> - Core framework interfaces</li>
<li><code>@struktos/adapter-express</code> - Express.js integration</li>
<li><code>@struktos/adapter-fastify</code> - Fastify integration</li>
<li><code>@struktos/auth</code> - Authentication &amp; Authorization</li>
</ul>
<a id="md:documentation" class="tsd-anchor"></a><h2><a href="#md:documentation">Documentation</a></h2><ul>
<li><a href="https://struktos.dev">Full Documentation</a></li>
<li><a href="https://struktos.dev/api/prisma">API Reference</a></li>
<li><a href="https://www.prisma.io/docs">Prisma Documentation</a></li>
</ul>
<a id="md:contributing" class="tsd-anchor"></a><h2><a href="#md:contributing">Contributing</a></h2><p>Contributions are welcome! Please read our <a href="CONTRIBUTING.md">Contributing Guide</a> for details.</p>
<a id="md:license" class="tsd-anchor"></a><h2><a href="#md:license">License</a></h2><p>MIT ¬© Struktos Contributors</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:struktosprisma"><span>@struktos/prisma</span></a><ul><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:quick-start"><span>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#md:1-create-repository-classes"><span>1. <wbr/>Create <wbr/>Repository <wbr/>Classes</span></a></li><li><a href="#md:2-set-up-unit-of-work-factory"><span>2. <wbr/>Set <wbr/>Up <wbr/>Unit of <wbr/>Work <wbr/>Factory</span></a></li><li><a href="#md:3-use-in-your-application"><span>3. <wbr/>Use in <wbr/>Your <wbr/>Application</span></a></li></ul></li><li><a href="#md:advanced-usage"><span>Advanced <wbr/>Usage</span></a></li><li><ul><li><a href="#md:manual-transaction-control"><span>Manual <wbr/>Transaction <wbr/>Control</span></a></li><li><a href="#md:using-savepoints"><span>Using <wbr/>Savepoints</span></a></li><li><a href="#md:context-integration"><span>Context <wbr/>Integration</span></a></li><li><a href="#md:custom-repository-implementation"><span>Custom <wbr/>Repository <wbr/>Implementation</span></a></li><li><a href="#md:error-handling"><span>Error <wbr/>Handling</span></a></li></ul></li><li><a href="#md:api-reference"><span>API <wbr/>Reference</span></a></li><li><ul><li><a href="#md:prismaunitofwork"><span>Prisma<wbr/>Unit<wbr/>Of<wbr/>Work</span></a></li><li><a href="#md:prismaunitofworkfactory"><span>Prisma<wbr/>Unit<wbr/>Of<wbr/>Work<wbr/>Factory</span></a></li><li><a href="#md:configuration-options"><span>Configuration <wbr/>Options</span></a></li></ul></li><li><a href="#md:isolation-levels"><span>Isolation <wbr/>Levels</span></a></li><li><a href="#md:related-packages"><span>Related <wbr/>Packages</span></a></li><li><a href="#md:documentation"><span>Documentation</span></a></li><li><a href="#md:contributing"><span>Contributing</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@struktos/prisma</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>